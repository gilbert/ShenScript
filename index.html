<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8"/>
        <title>ShenScript</title>
        <script src="dist/bundle.js"></script>
        <script type="text/shen">
            (js.
                "window.setTextOn = (id, text) => document.getElementById(id).innerText = text"
                "setTextOn('os', kl.symbols[Transpiler.rename('*os*')])"
                "setTextOn('implementation', kl.symbols[Transpiler.rename('*implementation*')])"
                "setTextOn('release', kl.symbols[Transpiler.rename('*release*')])"
                "window.getSourceKl = () => document.getElementById('kl-code').value"
                "window.doParseKl = () => console.log(Parser.parseString(getSourceKl()))"
                "window.doTranslateTailKl = () => console.log(Transpiler.translateTail(Parser.parseString(getSourceKl())))"
                "window.doTranslateHeadKl = () => console.log(Transpiler.translateHead(Parser.parseString(getSourceKl())))"
                "window.doRunTailKl = () => console.log(eval(Transpiler.translateTail(Parser.parseString(getSourceKl()))))"
                "window.doRunHeadKl = () => console.log(Kl.runAll(eval(Transpiler.translateHead(Parser.parseString(getSourceKl())))))"
                "window.getSourceShen = () => document.getElementById('shen-code').value"
                "window.getParsedSourceShen = () => { const s = Kl.headCall(kl.fns.shen$doelim_def, [Kl.headCall(kl.fns.read_from_string, [getSourceShen()])]); return s === null ? null : s.hd; }"
                "window.doParseShen = () => console.log(getParsedSourceShen())"
                "window.doTranslateTailShen = () => console.log(Transpiler.translateTail(getParsedSourceShen()))"
                "window.doTranslateHeadShen = () => console.log(Transpiler.translateHead(getParsedSourceShen()))"
                "window.doRunTailShen = () => console.log(eval(Transpiler.translateTail(getParsedSourceShen())))"
                "window.doRunHeadShen = () => console.log(Kl.runAll(eval(Transpiler.translateHead(getParsedSourceShen()))))")
        </script>
        <script>
            setTimeout(function () {
                const input = document.getElementById('repl-input');
                const output = document.getElementById('repl-output');
                input.addEventListener('keydown', e => {
                    if (e.key === 'Enter') {
                        const text = input.value;
                        for (let i = 0; i < text.length; ++i) {
                            consolePipe.buffer.push(text[i]);
                        }
                        input.value = '';
                    }
                });
                consolePipe.writeByte = b => output.value = output.value + String.fromCharCode(b);
                mountFile('kernel/tests/README.shen');
                mountFile('kernel/tests/tests.shen');
                mountFile('kernel/tests/prolog.shen');
                mountFile('kernel/tests/einstein.shen');
                mountFile('kernel/tests/parse.prl');
                mountFile('kernel/tests/cartprod.shen');
                mountFile('kernel/tests/powerset.shen');
                mountFile('kernel/tests/bubble version 1.shen');
                mountFile('kernel/tests/bubble version 2.shen');
                mountFile('kernel/tests/spreadsheet.shen');
                mountFile('kernel/tests/prime.shen');
                mountFile('kernel/tests/mutual.shen');
                mountFile('kernel/tests/change.shen');
                mountFile('kernel/tests/semantic net.shen');
                mountFile('kernel/tests/proplog version 1.shen');
                mountFile('kernel/tests/proplog version 2.shen');
                mountFile('kernel/tests/metaprog.shen');
                mountFile('kernel/tests/binary.shen');
                mountFile('kernel/tests/streams.shen');
                mountFile('kernel/tests/strings.shen');
                mountFile('kernel/tests/calculator.shen');
                mountFile('kernel/tests/structures-untyped.shen');
                mountFile('kernel/tests/structures-typed.shen');
                mountFile('kernel/tests/classes-untyped.shen');
                mountFile('kernel/tests/classes-typed.shen');
                mountFile('kernel/tests/stack.shen');
                mountFile('kernel/tests/yacc.shen');
                mountFile('kernel/tests/n queens.shen');
                mountFile('kernel/tests/search.shen');
                mountFile('kernel/tests/whist.shen');
                mountFile('kernel/tests/interpreter.shen');
                mountFile('kernel/tests/proof assistant.shen');
                mountFile('kernel/tests/qmachine.shen');
                mountFile('kernel/tests/depth\'.shen');
                mountFile('kernel/tests/TinyTypes.shen');
                mountFile('kernel/tests/TinyLispFunctions.txt');
            }, 0);
        </script>
        <style>
            textarea {
                height: 100px;
                width: 700px;
            }
            #repl-output {
                height: 300px;
            }
            input {
                width: 700px;
            }
        </style>
    </head>
    <body>
        <p>
            os:             <strong id="os"></strong>,
            implementation: <strong id="implementation"></strong>,
            release:        <strong id="release"></strong>
        </p>
        <h3>KL</h3>
        <textarea id="kl-code"></textarea>
        <br>
        <button onclick="doParseKl();">Parse</button>
        <button onclick="doTranslateTailKl();">Translate Tail</button>
        <button onclick="doTranslateHeadKl();">Translate Head</button>
        <button onclick="doRunTailKl();">Run Tail</button>
        <button onclick="doRunHeadKl();">Run Head</button>
        <br>
        <h3>Shen</h3>
        <textarea id="shen-code"></textarea>
        <br>
        <button onclick="doParseShen();">Parse</button>
        <button onclick="doTranslateTailShen();">Translate Tail</button>
        <button onclick="doTranslateHeadShen();">Translate Head</button>
        <button onclick="doRunTailShen();">Run Tail</button>
        <button onclick="doRunHeadShen();">Run Head</button>
        <br>
        <h3>Shen REPL</h3>
        <textarea id="repl-output" readonly></textarea>
        <br>
        <input type="text" id="repl-input">
    </body>
</html>
